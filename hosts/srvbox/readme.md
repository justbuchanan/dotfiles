# NixOS installation notes

- boot from minimal nixos thumb drive
- start dhcpcd systemd service to get ethernet working
- clone dotfiles repo, switch to srvbox-nixos branch
- sudo nix --experimental-features "nix-command flakes" run github:nix-community/disko -- --mode disko ./hosts/srvbox/disk-config.nix
- enter password for encrypted partition
- sudo nixos-generate-config --no-filesystems --root /mnt
- sudo mv /mnt/etc/nixos/hardware-configuration.nix dotfiles/hosts/srvbox/
- delete /etc/nixos/configuration.nix (this was autogenerated)
- sudo nixos-install --root /mnt --flake .#srvbox
- enroll tpm for encrypted partition key: systemd-cryptenroll --tpm2-device=auto --tpm2-pcrs=0+7
- Set a recovery password: cryptsetup luksAddKey /dev/nvme0n1p2

- sudo reboot

- login as root

- sudo passwd justin
- su - justin # note: the '-' is important.
- put dotfiles repo in the right place and cd into it
- home-manager switch --flake .
- exit and login to justin acct via tuigreet

- login to chrome, bitwarden
- sudo tailscale up
- generate user ssh key
- login to github and enroll ssh key
- generate user ed25519 key - see secrets/secrets.nix

- sudo ln -s $PWD/flake.nix /etc/nixos/

- because zpool was last used on another system (previous arch linux install), the automatic mounting doesn't work. do sudo zpool import -f zpool0

- spotify: Settings -> Display -> Show desktop notifications when the song changes: set to false
